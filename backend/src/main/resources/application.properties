# --- Server Config ---
server.port=8080

# --- Tomcat Thread Pool (for 5000 concurrent HTTP requests) ---
server.tomcat.threads.max=500
server.tomcat.threads.min-spare=50
server.tomcat.max-connections=10000
server.tomcat.accept-count=1000
server.tomcat.connection-timeout=20s

# --- Database Configuration (PostgreSQL) ---
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/flashtix_db}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:password}
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# --- HIGH CONCURRENCY TUNING (HikariCP) ---
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# --- Caching Configuration (Redis) ---
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.timeout=2000

# --- Redis Connection Pool (Lettuce) ---
spring.redis.lettuce.pool.max-active=50
spring.redis.lettuce.pool.max-idle=20
spring.redis.lettuce.pool.min-idle=5
spring.redis.lettuce.pool.max-wait=2000

# --- Transaction Configuration ---
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# --- Logging ---
spring.jpa.show-sql=false
logging.level.com.flashtix.backend=INFO
logging.level.org.springframework.retry=DEBUG
logging.level.org.springframework.orm.jpa=WARN

# --- Observability (Actuator) ---
# Expose the prometheus endpoint for scraping
management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.endpoint.health.show-details=always
management.metrics.tags.application=flashtix-backend
management.metrics.export.prometheus.enabled=true

# --- Retry Configuration (optional tuning) ---
spring.retry.max-attempts=3
